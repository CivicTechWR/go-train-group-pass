name: Verify MCP Servers

on:
  workflow_dispatch:
  schedule:
    # Run weekly on Monday at 9 AM
    - cron: '0 9 * * 1'

jobs:
  verify-mcp:
    name: Check MCP Server Health
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install uv
        run: curl -LsSf https://astral.sh/uv/install.sh | sh

      - name: Add uv to PATH
        run: echo "$HOME/.local/bin" >> $GITEA_PATH

      - name: Verify MCP health check script exists
        run: |
          if [ ! -f scripts/verify-mcp-health.sh ]; then
            echo "âŒ MCP health check script missing!"
            exit 1
          fi

      - name: Make script executable
        run: chmod +x scripts/verify-mcp-health.sh scripts/setup-all-mcp-servers.sh

      - name: Document MCP servers
        run: |
          echo "## Available MCP Servers" > MCP_STATUS.md
          echo "" >> MCP_STATUS.md
          echo "Last checked: $(date)" >> MCP_STATUS.md
          echo "" >> MCP_STATUS.md
          echo "### Core Servers" >> MCP_STATUS.md
          echo "- filesystem - File operations" >> MCP_STATUS.md
          echo "- memory - Persistent context" >> MCP_STATUS.md
          echo "- sequential-thinking - Complex reasoning" >> MCP_STATUS.md
          echo "- git - Git operations" >> MCP_STATUS.md
          echo "- fetch - HTTP requests" >> MCP_STATUS.md
          echo "" >> MCP_STATUS.md
          echo "### Database Servers" >> MCP_STATUS.md
          echo "- supabase - Supabase operations" >> MCP_STATUS.md
          echo "- postgres - PostgreSQL direct access" >> MCP_STATUS.md
          echo "" >> MCP_STATUS.md
          echo "### Development Servers" >> MCP_STATUS.md
          echo "- playwright - E2E testing" >> MCP_STATUS.md
          echo "- chrome-devtools - Frontend debugging" >> MCP_STATUS.md
          echo "- github - GitHub integration" >> MCP_STATUS.md
          echo "" >> MCP_STATUS.md
          echo "### Documentation & Search" >> MCP_STATUS.md
          echo "- context7 - AI documentation" >> MCP_STATUS.md
          echo "- everything - Advanced search" >> MCP_STATUS.md
          echo "" >> MCP_STATUS.md
          echo "Run './scripts/setup-all-mcp-servers.sh' to install all servers" >> MCP_STATUS.md

      - name: Commit MCP status
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add MCP_STATUS.md || true
          git commit -m "docs: Update MCP server status [skip ci]" || echo "No changes to commit"
          git push || echo "No changes to push"
